<!-- Main Content -->
<div class="main-content">
  <!-- Sidebar Filters -->
  <aside class="sidebar">
    <div class="filter-section">
      <h3>Filters</h3>

      <!-- Categories -->
      <div class="filter-group">
        <label>Category</label>
        <select [(ngModel)]="selectedCategory" (change)="onFilterChange()">
          <option value="">All Categories</option>
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <!-- Price Range -->
      <div class="filter-group">
        <label>Max Price: {{ formatPrice(priceRange) }}</label>
        <input type="range" min="0" max="1000" [(ngModel)]="priceRange" (input)="onFilterChange()" class="price-slider">
      </div>

      <!-- Sort -->
      <div class="filter-group">
        <label>Sort By</label>
        <select [(ngModel)]="sortBy" (change)="onFilterChange()">
          <option value="newest">Newest</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="name">Name (A-Z)</option>
        </select>
      </div>

      <button class="btn btn-reset" (click)="resetFilters()">Reset Filters</button>
    </div>

    <!-- Categories List -->
    <div class="categories-list">
      <h3>Categories</h3>
      <ul>
        @for (cat of categories; track $index) {
        <li>
          <a href="#" (click)="selectedCategory = cat; onFilterChange(); $event.preventDefault()">{{ cat }}</a>
        </li>
        }
      </ul>
    </div>
  </aside>

  <!-- Products Section -->
  <section class="products-section">
    <div class="products-header">
      <h2>Products ({{ filteredProducts.length }})</h2>
    </div>

    @if (error) {
    <div class="alert alert-error">
      {{ error }}
    </div>
    }

    @if (loading) {
    <div class="loading">
      <p>Loading products...</p>
    </div>
    }

    @if (!loading && filteredProducts.length > 0) {
    <div class="products-grid">
      @for (product of filteredProducts; track product.productId) {
      <div class="product-card" [routerLink]="['/main/catalog', product.productId]" style="cursor: pointer;">
        <div class="product-image">
          @if (product.imageUrl) {
          <img [src]="product.imageUrl" [alt]="product.name" />
          }
          @if (!product.imageUrl) {
          <div class="no-image">
            <span>No image</span>
          </div>
          }
          @if (product.stockQuantity === 0) {
          <div class="product-badge">Out of Stock</div>
          }
        </div>
        <div class="product-info">
          <h4>{{ product.name }}</h4>
          @if (product.category) {
          <p class="category">{{ product.category }}</p>
          }
          <div class="rating">
            <span class="stars">★★★★★</span>
            <span class="reviews">(0 reviews)</span>
          </div>
          <p class="price">{{ formatPrice(product.price) }}</p>
          @if (product.stockQuantity > 0) {
          <button class="btn btn-primary" (click)="addToCart(product); $event.stopPropagation()">
            Add to Cart
          </button>
          } @else {
          <button class="btn btn-wishlist" (click)="addToWishlist(product); $event.stopPropagation()">
            <mat-icon>favorite</mat-icon>
            Add to Wishlist
          </button>
          }
        </div>
      </div>
      }
    </div>
    }

    @if (!loading && filteredProducts.length === 0) {
    <div class="no-products">
      <p>No products match your criteria</p>
    </div>
    }
  </section>
</div>