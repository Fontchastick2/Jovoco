<div class="orders-container">
  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a href="/main/home">Home</a>
    <span>/</span>
    <span>My Cart & Orders</span>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn" [class.active]="activeTab === 'cart'" (click)="activeTab = 'cart'">
        <mat-icon>shopping_cart</mat-icon>
        Shopping Cart ({{ cartItems.length }})
      </button>
      <button class="tab-btn" [class.active]="activeTab === 'orders'" (click)="activeTab = 'orders'">
        <mat-icon>shopping_bag</mat-icon>
        My Orders ({{ orders.length }})
      </button>
    </div>

    <!-- Cart Section -->
    <div class="orders-section" *ngIf="activeTab === 'cart'">
      <div class="section-header">
        <h2>Shopping Cart</h2>
        <p class="subtitle">{{ cartItems.length }} item(s)</p>
      </div>

      <div *ngIf="error" class="alert alert-error">
        {{ error }}
      </div>

      <!-- Cart Items -->
      <div *ngIf="cartItems.length > 0" class="cart-wrapper">
        <div class="cart-items">
          <div class="cart-table">
            <div class="table-header">
              <div class="col-product">Product</div>
              <div class="col-price">Price</div>
              <div class="col-quantity">Quantity</div>
              <div class="col-subtotal">Subtotal</div>
              <div class="col-actions">Actions</div>
            </div>
            <div *ngFor="let item of cartItems" class="table-row">
              <div class="col-product">
                <div class="product-info">
                  <img *ngIf="item.imageUrl" [src]="item.imageUrl" [alt]="item.productName" class="product-image">
                  <div *ngIf="!item.imageUrl" class="product-image-placeholder">
                    <mat-icon>image</mat-icon>
                  </div>
                  <span>{{ item.productName }}</span>
                </div>
              </div>
              <div class="col-price">{{ formatPrice(item.price) }}</div>
              <div class="col-quantity">
                <input type="number" [value]="item.quantity" (change)="updateQuantity(item.productId, $any($event.target).value)" min="1" class="quantity-input">
              </div>
              <div class="col-subtotal">{{ formatPrice(item.price * item.quantity) }}</div>
              <div class="col-actions">
                <button class="btn-icon" (click)="removeFromCart(item.productId)" title="Remove">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Cart Summary Sidebar -->
        <div class="cart-sidebar">
          <div class="cart-summary">
            <h3>Cart Totals</h3>
            <div class="summary-row">
              <span>Subtotal</span>
              <span>{{ formatPrice(getCartTotal()) }}</span>
            </div>
            <div class="summary-row">
              <span>Shipping</span>
              <span>Free</span>
            </div>
            <div class="summary-row total">
              <span>Total</span>
              <span>{{ formatPrice(getCartTotal()) }}</span>
            </div>
          </div>

          <!-- Cart Actions -->
          <div class="cart-actions">
            <button class="btn btn-primary" (click)="checkout()">
              <mat-icon>check_circle</mat-icon>
              Proceed to Checkout
            </button>
            <button class="btn btn-secondary" (click)="clearCart()">
              <mat-icon>delete_sweep</mat-icon>
              Clear Cart
            </button>
          </div>
        </div>
      </div>

      <!-- Empty Cart -->
      <div *ngIf="cartItems.length === 0" class="no-orders">
        <mat-icon>shopping_cart</mat-icon>
        <p>Your cart is empty</p>
        <a href="/main/catalog" class="btn btn-primary">Continue Shopping</a>
      </div>
    </div>

    <!-- Orders Section -->
    <div class="orders-section" *ngIf="activeTab === 'orders'">
      <div class="section-header">
        <h2>My Orders</h2>
        <p class="subtitle">{{ orders.length }} order(s)</p>
      </div>

      <div *ngIf="error" class="alert alert-error">
        {{ error }}
      </div>

      <div *ngIf="loading" class="loading">
        <p>Chargement des commandes...</p>
      </div>

      <div *ngIf="!loading && orders.length > 0" class="orders-list">
        <div *ngFor="let order of orders" class="order-card">
          <div class="order-header" (click)="selectOrder(order)">
            <div class="order-info">
              <h3>Commande #{{ order.orderId | slice: 0: 8 }}</h3>
              <p class="order-date">{{ formatDate(order.createdAt) }}</p>
            </div>
            <div class="order-status">
              <span [ngClass]="getStatusBadgeClass(order.status)" class="status-badge">
                {{ getStatusLabel(order.status) }}
              </span>
            </div>
            <div class="order-total">
              <p class="total-label">Total</p>
              <p class="total-amount">{{ formatPrice(order.totalAmount) }}</p>
            </div>
            <div class="expand-icon">
              <mat-icon>{{ selectedOrder?.orderId === order.orderId ? 'expand_less' : 'expand_more' }}</mat-icon>
            </div>
          </div>

          <!-- Order Details (Expandable) -->
          <div *ngIf="selectedOrder?.orderId === order.orderId" class="order-details">
            <!-- Customer Info -->
            <div class="details-section">
              <h4>Customer Information</h4>
              <div class="info-grid">
                <div class="info-item">
                  <label>Name</label>
                  <p>{{ order.customerName }}</p>
                </div>
                <div class="info-item">
                  <label>Email</label>
                  <p>{{ order.customerEmail }}</p>
                </div>
                <div class="info-item" *ngIf="order.customerAddress">
                  <label>Address</label>
                  <p>{{ order.customerAddress }}</p>
                </div>
              </div>
            </div>

            <!-- Order Items -->
            <div class="details-section">
              <h4>Order Items</h4>
              <div class="items-table">
                <div class="table-header">
                  <div class="col-product">Product</div>
                  <div class="col-price">Price</div>
                  <div class="col-quantity">Quantity</div>
                  <div class="col-subtotal">Subtotal</div>
                </div>
                <div *ngFor="let item of order.items" class="table-row">
                  <div class="col-product">
                    <div class="product-info">
                      <img *ngIf="item.imageUrl" [src]="item.imageUrl" [alt]="item.productName" class="product-image">
                      <div *ngIf="!item.imageUrl" class="product-image-placeholder">
                        <mat-icon>image</mat-icon>
                      </div>
                      <span>{{ item.productName }}</span>
                    </div>
                  </div>
                  <div class="col-price">{{ formatPrice(item.price) }}</div>
                  <div class="col-quantity">{{ item.quantity }}</div>
                  <div class="col-subtotal">{{ formatPrice(item.price * item.quantity) }}</div>
                </div>
              </div>
            </div>

            <!-- Order Summary -->
            <div class="details-section">
              <h4>Order Summary</h4>
              <div class="summary-grid">
                <div class="summary-row">
                  <span>Subtotal</span>
                  <span>{{ formatPrice(order.totalAmount * 0.9) }}</span>
                </div>
                <div class="summary-row">
                  <span>Shipping</span>
                  <span>Free</span>
                </div>
                <div class="summary-row">
                  <span>Tax</span>
                  <span>{{ formatPrice(order.totalAmount * 0.1) }}</span>
                </div>
                <div class="summary-row total">
                  <span>Total</span>
                  <span>{{ formatPrice(order.totalAmount) }}</span>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="details-section actions">
              <button class="btn btn-secondary" (click)="selectOrder(order)">
                <mat-icon>close</mat-icon>
                Close
              </button>
              <button class="btn btn-danger" (click)="deleteOrder(order.orderId)">
                <mat-icon>delete</mat-icon>
                Delete Order
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!loading && orders.length === 0" class="no-orders">
        <mat-icon>shopping_bag</mat-icon>
        <p>You have no orders yet</p>
        <a href="/main/home" class="btn btn-primary">Continue Shopping</a>
      </div>
    </div>
  </div>